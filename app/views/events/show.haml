#title
  %h1
    = @event.name
    - if @event.allow_edits_by(current_user)
      .admin_actions
        %span= link_to t('events.edit.link'), edit_event_path(@event)
        %span= link_to t('events.edit.admin_attendees.link'), event_everyone_path(@event)

  #info_short
    %address.organizer
      %span=t "events.show.organizer"
      = image_tag @event.host.picture_url, class: "tiny avatar"
      = @event.host.name

    .tagline
      = tagline(@event)
      = link_to_invite_if_allowed @event

  #left_column

    #description
      =simple_format @event.description

    %section#comments
      - if signed_in?
        = render 'comments/new'
      - if @comments.any?
        %ol= render @comments

  %aside#time_and_space
    %time.start_time(datetime="#{@event.start_at.to_s(:db)}")
      = l(@event.start_at, format: :default).capitalize

    - if @event.end_at.present?
      %time.end_time(datetime="#{@event.end_at.to_s(:db)}")
        = fancy_end_at @event
    - else
      %span.end_time
        =t "events.show.end_time.default"

    .location= @event.location
    - if @event.city.present?
      .city= @event.city

  %aside#actions
    - if signed_in?
      = render "attendance_actions", attendance: @attendance, event: @event
    - else
      = t("event.need_login_to_confirm")

  %aside#feeds
    = t("events.show.feed.subscribe")
    = link_to t("events.show.feed.ical/outlook"), "#{event_path(@event) }.ics", :class => "calendar"
    = link_to t("events.show.feed.gcal"), @event.to_gcal, :class => "calendar"

  - if @event.confirmed_invitations.any?
    %aside#confirmed_guests.guests.alternate
      %h2
        = t 'events.show.confirmed', count: @event.confirmed_invitations.size
      - if @event.limited?
        %span= t "events.show.available_seats", count: @event.available_slots
      %ul= render @confirmed_invitations
      - if @event.confirmed_invitations.size > EventsController::MAX_CONFIRMED_ATTENDEES
        = link_to t('event.form.see_all'), event_confirmed_path(@event)


  - if @event.waitlisted_invitations.any?
    %aside#waitlist.guests
      %h2
        = t "events.show.waitlist"
        %span= t "events.show.people_waiting", count: @event.waitlisted_invitations.size
      %ul= render @waitlisted_invitations
      - if @event.waitlisted_invitations.size > EventsController::MAX_WAITLISTED_ATTENDEES
        = link_to t('event.form.see_all'), event_waitlisted_path(@event)


  %aside#unconfirmed.guests{ :class => @event.waitlisted_invitations.any? ? "alternate" : "" }
    %h2=t "events.show.invited", count: @event.pending_invitations.size
    - if signed_in?
      %span= link_to_invite_if_allowed @event
    - if @event.pending_invitations.size > EventsController::MAX_PENDING_ATTENDEES
      = link_to t('event.form.see_all'), event_invited_path(@event)
    %ul= render @pending_invitations

#modal_window

- content_for :javascript do
  :javascript
    $(document).ready(function(){
      router = new A8.Routers.EventRouter(#{@event.id});
      router.counter_updated(#{@event.attendances.size})
    });


= render "invite_people_template"
