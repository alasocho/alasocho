#event
  %section#title.row
    .columns.span8
      %h1= @event.name

      .tagline
        = tagline(@event)
        = link_to_invite_if_allowed @event

    .columns.span8
      - if @event.allow_edits_by(current_user)
        .admin_actions
          %span= link_to t('events.edit.link'), edit_event_path(@event)
          %span= link_to t('events.manage_attendees.link'), event_everyone_path(@event)

      %address.organizer
        %span=t "events.show.organizer"
        = image_tag @event.host.picture_url, class: "inline avatar"
        = @event.host.name


  %section.row
    .columns.span8
      #description
        =simple_format @event.description

      #comments
        - if signed_in?
          = render 'comments/new'
        - if @comments.any?
          %ol= render @comments

    .columns.span8

      #time_and_space.alert-message.block-message.info
        %time.start_time(datetime="#{@event.start_at.to_s(:db)}")
          = l(@event.start_at, format: :default).capitalize

        - if @event.end_at.present?
          %time.end_time(datetime="#{@event.end_at.to_s(:db)}")
            = fancy_end_at @event
        - else
          %span.end_time
            =t "events.show.end_time.default"

        .location= @event.location
        - if @event.city.present?
          .city= @event.city

      #rsvp.alert-message.block-message{ class: rsvp_class(@attendance) }
        %h3= t(".rsvp")
        - if signed_in?
          = render "attendance_actions", attendance: @attendance
        - else
          = t("event.need_login_to_confirm")

      #feeds
        = t("events.show.feed.subscribe")
        = link_to t("events.show.feed.ical/outlook"), event_path(@event, format: :ics), :class => "calendar"
        = link_to t("events.show.feed.gcal"), @event.to_gcal, :class => "calendar"

      - if @event.confirmed_invitations.any?
        #confirmed_guests.alert-message.block-message.guests.clearfix
          %h3
            = t 'events.show.confirmed', count: @event.confirmed_invitations.size
          - if @event.limited?
            %span= t "events.show.available_seats", count: @event.available_slots
          %ul= render @confirmed_invitations
          - if @event.confirmed_invitations.size > EventsController::MAX_CONFIRMED_ATTENDEES
            = link_to t('event.form.see_all'), event_confirmed_path(@event)


      - if @event.waitlisted_invitations.any?
        #waitlist.alert-message.block-message.guests.clearfix
          %h3
            = t "events.show.waitlist"
            %span= t "events.show.people_waiting", count: @event.waitlisted_invitations.size
          %ul= render @waitlisted_invitations
          - if @event.waitlisted_invitations.size > EventsController::MAX_WAITLISTED_ATTENDEES
            = link_to t('event.form.see_all'), event_waitlisted_path(@event)


      #unconfirmed.alert-message.block-message.guests.clearfix
        %h3=t "events.show.invited", count: @event.pending_invitations.size
        %span= link_to_invite_if_allowed @event
        - if @event.pending_invitations.size > EventsController::MAX_PENDING_ATTENDEES
          = link_to t('event.form.see_all'), event_invited_path(@event)
        %ul= render @pending_invitations

      - if @event.declined_invitations.any?
        #declined.alert-message.block-message.guests.clearfix
          %h3
            %span= t "events.show.declined", count: @event.declined_invitations.size
          = link_to t('event.form.see_all'), event_declined_path(@event)

  - content_for :javascript do
    :javascript
      window.current_page = window.current_page || {}
      window.current_page.event = current_page.event || new A8.Models.Event(#{@event.to_json});
